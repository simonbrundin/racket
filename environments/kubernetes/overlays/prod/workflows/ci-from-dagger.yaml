# apiVersion: argoproj.io/v1alpha1
# kind: Sensor
# metadata:
#   name: ci-from-dagger
#   namespace: argo-events
# spec:
#   template:
#     serviceAccountName: argo-workflow
#   dependencies:
#     - name: push
#       eventSourceName: github
#       eventName: with-api-credentials
#       filters:
#         data:
#           - path: headers.X-Github-Event
#             type: string
#             value: ["push"]
#           - path: body.repository.full_name
#             type: string
#             value: ["simonbrundin/racket"]
#     - name: backend
#       eventSourceName: github
#       eventName: with-api-credentials
#       filters:
#         dataLogicalOperator: "or"
#         data:
#           - path: '[body.commits.#.modified.#(%"*backend*")#,body.commits.#.added.#(%"*backend*")#,body.commits.#.removed.#(%"*backend*")#]'
#             type: string
#             value:
#               - "(\\bbackend/*)"
#
#   triggers:
#     - template:
#         name: argo-workflow-trigger-from-dagger
#         argoWorkflow:
#           operation: submit
#           source:
#             resource:
#               apiVersion: argoproj.io/v1alpha1
#               kind: Workflow
#               metadata:
#                 generateName: racket-ci-from-dagger-
#                 namespace: argo-events
#               spec:
#                 entrypoint: entrypoint
#                 volumes:
#                   - name: dagger-socket
#                     emptyDir: {}
#                   - name: dagger-storage
#                     emptyDir: {}
#                 arguments:
#                   parameters:
#                     - name: source-folder
#                       value: "backend"
#                     - name: tag
#                       # TODO: hur l√∂ser jag att uppdatera tag och semver?
#                       value: "{{workflow.creationTimestamp.YYYYMMDD-HHmm}}"
#                     - name: repo-name
#                       value: "racket"
#                     - name: source-repo-url
#                       value: "github.com/simonbrundin/racket.git"
#                     - name: registry-address
#                       value: "ghcr.io/simonbrundin"
#                     - name: registry-username
#                       value: "simonbrundin"
#                     - name: registry-password-env
#                       value: GITHUB_TOKEN
#                 templates:
#                   - name: entrypoint
#                     dag:
#                       tasks:
#                         - name: ci
#                           templateRef:
#                             name: pipeline
#                             template: ci
#                             clusterScope: true
